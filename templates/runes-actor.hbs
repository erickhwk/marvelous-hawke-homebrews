<form class="mhh-runes-actor flexcol" autocomplete="off">
  <section class="mhh-runes-body flexcol">

    <header class="mhh-runes-header">
      <h2>Runas de {{actor.name}}</h2>
      <p class="notes">
        Arraste uma runa do inventário para um item com slots. Clique na lixeira para removê-la.
      </p>
    </header>

    <!-- OFENSIVAS -->
    <h3>Ofensivas (Armas & Focos)</h3>

    {{#if offensiveItems.length}}
      {{#each offensiveItems as |row|}}
        <div class="mhh-runes-item-row flexrow" data-item-id="{{row.id}}">

          <!-- LADO ESQUERDO: ícone + nome + info -->
          <div class="mhh-runes-item-left flexrow">
            <div class="mhh-runes-item-row__icon">
              <img src="{{row.img}}" width="32" height="32" />
            </div>

            <div class="mhh-runes-item-row__info flexcol">
              <div class="mhh-runes-item-row__name">{{row.name}}</div>
              <div class="mhh-runes-item-row__meta small">
                {{row.rarityLabel}} · Slots {{row.maxSlots}}
                {{#if row.equipped}}
                  · <span class="tag tag-success">Equipado</span>
                {{else}}
                  · <span class="tag tag-warning">Não equipado</span>
                {{/if}}
              </div>
            </div>
          </div>

          <!-- LADO DIREITO: slots (select + botão) -->
          <div class="mhh-runes-item-right flexcol">
            {{#if row.slots.length}}
              {{#each row.slots as |slot|}}
                <div class="mhh-runes-slotRow flexrow" data-slot-index="{{slot.index}}">

                  {{#if slot.rune}}
                    <!-- Slot preenchido -->
                    <div class="mhh-runes-slot__content flexrow">
                      <span class="mhh-runes-slot__label">
                        {{slot.label}}
                      </span>
                      <button type="button"
                              class="mhh-runes-slot__remove icon-only"
                              data-action="remove"
                              data-item-id="{{../id}}"
                              data-slot="{{slot.index}}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>

                  {{else}}
                    <!-- Slot vazio → select + botão -->
                    <div class="mhh-runes-slot__empty flexrow">
                      <select class="mhh-runes-slot-select"
                              data-item-id="{{../id}}"
                              data-slot="{{slot.index}}">
                        <option value="">— Escolha uma runa —</option>
                        {{#each @root.offensiveRunes as |rChoice|}}
                          <option value="{{rChoice.id}}">
                            {{rChoice.label}}
                          </option>
                        {{/each}}
                      </select>

                      <button type="button"
                              class="mhh-runes-slot-apply icon-only"
                              data-item-id="{{../id}}"
                              data-slot="{{slot.index}}">
                        <i class="fas fa-check"></i>
                      </button>
                    </div>
                  {{/if}}

                </div>
              {{/each}}
            {{else}}
              <span class="notes small">Sem slots de runa.</span>
            {{/if}}
          </div>

        </div>
      {{/each}}
    {{else}}
      <p class="notes">Nenhum item ofensivo com slots de runa.</p>
    {{/if}}

    <hr/>

    <!-- DEFENSIVAS -->
    <h3>Defensivas (Armaduras & Escudos)</h3>

    {{#if defensiveItems.length}}
      {{#each defensiveItems as |row|}}
        <div class="mhh-runes-item-row flexrow" data-item-id="{{row.id}}">

          <!-- LADO ESQUERDO: ícone + nome + info -->
          <div class="mhh-runes-item-left flexrow">
            <div class="mhh-runes-item-row__icon">
              <img src="{{row.img}}" width="32" height="32" />
            </div>

            <div class="mhh-runes-item-row__info flexcol">
              <div class="mhh-runes-item-row__name">{{row.name}}</div>
              <div class="mhh-runes-item-row__meta small">
                {{row.rarityLabel}} · Slots {{row.maxSlots}}
                {{#if row.equipped}}
                  · <span class="tag tag-success">Equipado</span>
                {{else}}
                  · <span class="tag tag-warning">Não equipado</span>
                {{/if}}
              </div>
            </div>
          </div>

          <!-- LADO DIREITO: slots (select + botão) -->
          <div class="mhh-runes-item-right flexcol">
            {{#if row.slots.length}}
              {{#each row.slots as |slot|}}
                <div class="mhh-runes-slotRow flexrow" data-slot-index="{{slot.index}}">

                  {{#if slot.rune}}
                    <!-- Slot preenchido -->
                    <div class="mhh-runes-slot__content flexrow">
                      <span class="mhh-runes-slot__label">
                        {{slot.label}}
                      </span>
                      <button type="button"
                              class="mhh-runes-slot__remove icon-only"
                              data-action="remove"
                              data-item-id="{{../id}}"
                              data-slot="{{slot.index}}">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>

                  {{else}}
                    <!-- Slot vazio → select + botão -->
                    <div class="mhh-runes-slot__empty flexrow">
                      <select class="mhh-runes-slot-select"
                              data-item-id="{{../id}}"
                              data-slot="{{slot.index}}">
                        <option value="">— Escolha uma runa —</option>
                        {{#each @root.defensiveRunes as |rChoice|}}
                          <option value="{{rChoice.id}}">
                            {{rChoice.label}}
                          </option>
                        {{/each}}
                      </select>

                      <button type="button"
                              class="mhh-runes-slot-apply icon-only"
                              data-item-id="{{../id}}"
                              data-slot="{{slot.index}}">
                        <i class="fas fa-check"></i>
                      </button>
                    </div>
                  {{/if}}

                </div>
              {{/each}}
            {{else}}
              <span class="notes small">Sem slots de runa.</span>
            {{/if}}
          </div>

        </div>
      {{/each}}
    {{else}}
      <p class="notes">Nenhum item defensivo com slots de runa.</p>
    {{/if}}

    <footer class="mhh-runes-actor__footer">
      <p class="notes small">
        Dica: selecione uma runa no slot desejado para instalá-la.
        Use o ícone de lixo para remover runas já instaladas.
      </p>
    </footer>

  </section>
</form>
